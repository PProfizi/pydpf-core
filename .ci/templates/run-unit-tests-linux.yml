
steps:
  - script: |
      pip install -r requirements_test.txt
      pip install pytest-azurepipelines
      export AWP_ROOT$(ANSYS_VERSION)=${SYSTEM_DEFAULTWORKINGDIRECTORY}/server/v$(ANSYS_VERSION)
      cd tests
      export DPF_IP=$(hostname -i)
      xvfb-run pytest -v --junitxml=junit/test-results.xml --cov ansys.dpf.core --cov-report=xml  --reruns 3
      export PATH=`pwd`
      echo ${PATH}
      displayName: Test Core API

  - task: PublishTestResults@2
    inputs:
      testResultsFormat: 'JUnit'
      testResultsFiles: 'junit/test-results.xml'
      testRunTitle: 'linuxTests$(ANSYS_VERSION)'
      publishRunAttachments: true
      searchFolder: 'tests/'
    condition: always()
