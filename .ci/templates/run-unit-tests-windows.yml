steps:
  - script: |
      @echo on
      cd $(System.DefaultWorkingDirectory)
      pip install -r requirements_test.txt
    displayName: Install Test Environment
    condition: always()

  - script: |
      @echo on
      cd tests
      dir .
      pytest -v --junitxml=junit/test-results.xml --cov ansys.dpf.core --cov-report=xml --reruns 3 .

    displayName: Test Core API
    condition: always()

  - task: PublishTestResults@2
    inputs:
      testResultsFormat: 'JUnit'
      testResultsFiles: 'tests/junit/test-results.xml'
      testRunTitle: 'windowsTests$(ANSYS_VERSION)'
      publishRunAttachments: true
    condition: always()